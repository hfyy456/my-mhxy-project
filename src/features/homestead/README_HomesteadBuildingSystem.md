# 家园建造系统

## 概述

家园建造系统是游戏的核心玩法之一，玩家可以在8x8的网格地图上建造各种建筑，通过建筑解锁新功能，逐步发展自己的家园。

## 系统特性

### 🏗️ 建筑系统
- **多格建筑**: 支持1x1到3x3不等大小的建筑
- **建筑分类**: 核心、资源生产、制作、商业、训练、功能、装饰等7大类
- **等级系统**: 建筑可升级，解锁更强功能
- **建造时间**: 真实时间建造，支持后台计时

### 🔓 功能解锁
- **商店系统**: 建造商业建筑解锁各类商店
- **制作系统**: 建造制作建筑解锁装备制作
- **训练系统**: 建造训练设施提升召唤兽能力
- **传送系统**: 建造传送门快速旅行
- **任务系统**: 建造城镇大厅解锁任务发布

### 📦 资源管理
- **6种资源**: 木材、石料、草药、矿石、精粹、金币
- **自动生产**: 资源建筑持续产出资源
- **存储上限**: 可通过仓库建筑扩展存储
- **资源消耗**: 建造和升级需要消耗资源

## 建筑类型

### 核心建筑
- **城镇大厅** 🏛️ (3x3)
  - 家园管理中心
  - 解锁更多建筑类型
  - 提供任务发布功能

### 资源生产建筑
- **伐木场** 🪓 (2x2) - 生产木材
- **高级采矿场** ⛏️ (2x3) - 生产矿石和石料
- **药草园** 🌿 (2x2) - 生产草药

### 商业建筑
- **杂货店** 🏪 (2x2) - 出售基础物品
- **装备店** ⚔️ (2x2) - 买卖武器装备

### 制作建筑
- **铁匠铺** 🔨 (3x2) - 锻造武器装备
- **炼金实验室** ⚗️ (2x3) - 炼制药剂

### 训练建筑
- **训练场** 🏟️ (3x3) - 提升召唤兽能力

### 功能建筑
- **大型仓库** 📦 (3x2) - 扩展存储容量
- **传送门** 🌀 (2x2) - 快速传送

### 装饰建筑
- **喷泉** ⛲ (1x1) - 提升家园魅力
- **花坛** 🌸 (1x1) - 装饰用途

## 建筑需求链

```
城镇大厅 (初始)
├── 杂货店 (需要城镇大厅 Lv.1)
├── 装备店 (需要城镇大厅 Lv.2)
├── 高级采矿场 (需要城镇大厅 Lv.1)
│   └── 铁匠铺 (需要高级采矿场 Lv.1)
├── 训练场 (需要城镇大厅 Lv.2)
└── 传送门 (需要城镇大厅 Lv.3)

药草园 (独立)
└── 炼金实验室 (需要药草园 Lv.1)

伐木场 (独立)
大型仓库 (独立)
装饰建筑 (独立)
```

## 使用指南

### 建造建筑
1. 点击"建造建筑"按钮
2. 从右侧菜单选择要建造的建筑
3. 在地图上点击合适的位置放置
4. 等待建造完成

### 资源收集
- 资源生产建筑会自动产出资源
- 定期收集资源以免达到存储上限
- 通过建造仓库扩展存储容量

### 功能解锁
- 建造特定建筑会解锁新功能
- 解锁的功能会在底部动作栏显示
- 灰色图标表示功能尚未解锁

## 技术实现

### 组件结构
```
src/features/homestead/
├── components/
│   ├── HomesteadMapView.jsx      # 主地图视图
│   ├── HomesteadActionBar.jsx    # 动作栏
│   └── HomesteadView.jsx         # 原有家园视图
├── config/
│   ├── enhancedBuildingConfig.js # 增强建筑配置
│   └── homesteadConfig.js        # 基础配置
└── store/
    └── enhancedHomesteadSlice.js # 状态管理
```

### 状态管理
- **plots**: 地块数据 (64个地块的8x8网格)
- **buildings**: 建筑实例数据
- **resources**: 资源数量
- **unlockedFeatures**: 已解锁的功能
- **activeTimers**: 活跃的计时器

### 配置系统
- **ENHANCED_BUILDINGS**: 建筑配置定义
- **BUILDING_CATEGORIES**: 建筑分类
- **UNLOCK_TYPES**: 解锁功能类型
- **PLACEMENT_RULES**: 建筑放置规则

## 扩展性

### 添加新建筑
1. 在 `enhancedBuildingConfig.js` 中定义建筑
2. 设置建筑属性、成本、解锁功能
3. 配置建筑需求链

### 添加新功能
1. 在 `UNLOCK_TYPES` 中定义新功能类型
2. 在 `enhancedHomesteadSlice.js` 中实现解锁逻辑
3. 在相应组件中处理功能使用

### 自定义规则
- **放置规则**: 最小距离、相邻加成等
- **解锁条件**: 等级、任务、道具等多种条件
- **资源配置**: 可自定义资源类型和产出

## 未来计划

- [ ] 建筑升级系统
- [ ] 建筑拆除和重建
- [ ] 更多建筑类型和功能
- [ ] 家园访问和社交功能
- [ ] 建筑皮肤和个性化
- [ ] 季节性活动建筑 