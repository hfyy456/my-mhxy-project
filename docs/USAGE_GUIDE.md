# 面向对象背包系统使用指南

## 🚀 快速开始

### 1. 启动应用

```bash
cd /e:/my-mhxy-project/my-mhxy-project
npm run dev
```

### 2. 访问新背包系统

1. 进入游戏主界面
2. 点击底部操作栏的 **"新背包系统"** 按钮（橙色按钮）
3. 新的背包管理器界面将打开

## 📦 功能介绍

### 主要功能区域

#### 1. 背包网格 (10x10)
- **点击格子**: 查看物品详情
- **拖拽**: 移动物品位置
- **空格子**: 灰色边框
- **有物品**: 蓝色边框，显示物品名称和数量

#### 2. 物品详情面板
- 显示选中物品的完整信息
- 提供操作按钮：使用、装备、分割

#### 3. 金币管理
- 显示当前金币数量
- 快速增减金币按钮（+100, +1000, -50）

#### 4. 容量信息
- 背包使用情况进度条
- 扩展容量按钮（+20个格子）
- 背包满时的警告提示

#### 5. 物品搜索
- 按名称搜索物品
- 按类型过滤（装备、消耗品、材料）
- 实时显示搜索结果

#### 6. 批量操作
- 批量添加测试物品
- 按类型排序背包

#### 7. 统计信息
- 物品种类和总数统计
- 总价值计算
- 按类型和稀有度分布

## 🔄 数据迁移功能

### 迁移选项

#### 1. 从Redux迁移数据
```
点击 "从Redux迁移数据" 按钮
```
- 自动读取现有Redux背包状态
- 将物品数据转换为新格式
- 保持插槽位置不变
- 保留金币和容量设置

#### 2. 同步到Redux
```
点击 "同步到Redux" 按钮
```
- 将新系统数据写回Redux
- 支持双向同步
- 保持数据一致性

#### 3. 创建测试数据
```
点击 "创建测试数据" 按钮
```
- 添加各种类型的示例物品：
  - 生命药水 (消耗品)
  - 钢铁剑 (武器装备)
  - 皮甲 (防具装备)
  - 魔法石 (材料)
- 增加1000金币

## 🎮 使用技巧

### 1. 物品管理
- **堆叠**: 相同的消耗品和材料会自动堆叠
- **装备**: 装备类物品不能堆叠
- **使用**: 点击物品详情中的"使用"按钮消耗物品
- **装备**: 装备类物品可以装备给召唤兽

### 2. 背包整理
- 使用搜索功能快速找到特定物品
- 利用排序功能整理背包
- 拖拽移动物品到合适位置

### 3. 容量管理
- 注意背包使用率，及时扩展容量
- 背包满时无法添加新物品
- 进度条颜色提示：绿色(正常) → 黄色(70%+) → 红色(90%+)

## 🛠️ 开发者功能

### 1. 事件监听
```javascript
// 监听背包变化
inventoryManager.on('inventory_changed', (state) => {
  console.log('背包状态更新:', state);
});

// 监听物品添加
inventoryManager.on('item_added', (data) => {
  console.log('添加物品:', data);
});
```

### 2. 直接API调用
```javascript
import { inventoryManager } from '@/store/InventoryManager';

// 添加物品
inventoryManager.addItem({
  name: '自定义物品',
  type: 'consumable',
  quantity: 10
});

// 移动物品
inventoryManager.moveItem(0, 5);

// 获取状态
const state = inventoryManager.getState();
```

### 3. 自定义Hooks
```javascript
import { useInventoryManager, useInventoryActions } from '@/hooks/useInventoryManager';

const MyComponent = () => {
  const { slots, gold, isLoading } = useInventoryManager();
  const actions = useInventoryActions();
  
  // 使用背包功能
};
```

## 🔍 调试与排查

### 1. 浏览器控制台
- 所有操作都会在控制台输出日志
- 错误信息会详细显示失败原因
- 迁移过程有详细的进度日志

### 2. 常见问题

**Q: 迁移失败怎么办？**
A: 检查控制台错误信息，确保Redux状态格式正确

**Q: 物品没有显示？**
A: 确认物品数据格式正确，检查是否有必需字段

**Q: 拖拽不工作？**
A: 确保浏览器支持拖拽API，检查是否有CSS冲突

**Q: 数据没有保存？**
A: 确认Electron Store配置正确，检查权限设置

### 3. 重置数据
如果遇到数据问题，可以：
1. 清除浏览器存储
2. 重启应用
3. 使用"创建测试数据"重新开始

## 📈 性能优化

### 1. 事件批处理
- 批量操作会减少UI重绘次数
- 大量物品操作时使用批量API

### 2. 内存管理
- 系统会自动清理无用的事件监听器
- 组件卸载时会清理资源

### 3. 持久化策略
- 自动保存延迟1秒，避免频繁写入
- 只有发生变化时才触发保存

## 🔮 未来功能

### 计划中的功能
- [ ] 物品分类标签
- [ ] 高级搜索过滤器
- [ ] 背包主题自定义
- [ ] 物品交易功能
- [ ] 背包快照和恢复
- [ ] 多角色背包管理

### 扩展能力
- 支持自定义物品类型
- 可扩展的效果系统
- 插件化的UI组件
- 多语言支持

---

享受新的背包管理体验！🎮 